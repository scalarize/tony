#!/usr/bin/env php
<?php declare(strict_types=1);
/** vim: set noet ts=4 sw=4 fdm=indent: */

require 'vendor/autoload.php';

require 'VarStackVisitor.php';

use PhpParser\{Node, NodeFinder};
use PhpParser\{Parser, ParserFactory};
use TonyParser\{VarStackVisitor};

function usage() {
	global $argv;
	echo "Usage: php $argv[0] -t <target_file_or_dir_to_parse> -s [section_to_show]\n";
}

$args = getopt('t:s:v');
if (empty($args['t'])) {
	usage();
	exit;
}

$visitor = new VarStackVisitor($args['t']);
$visitor->traverse();
foreach ($visitor->getVarStacks() as $target => $vars) {
	if ($args['s'] && $target != $args['s']) continue;
	echo "=== $target ===\n";
	foreach ($vars as $name => $vals) {
		echo "  $name => [\n";
		foreach ($vals as $val) {
			echo "    " . $val->getType() . "\n";
		}
		echo "  ];\n";
	}
}

